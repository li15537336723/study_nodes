# 计算机网络核心知识点大梳理



## OSI七层模型

**物理层**

* 解决两台物理机之间的通信需求
* 物理层主要定义了物理设备的标准，如网线的类型，光纤的接口类型，各种传输介质的传输速率。
* **网卡工作在这层**。
* 物理层是OSI七层模型的物理基础，没有它就谈不上数据传输了

**数据链路层**

- 数据链路层定义了**如何格式化数据进行传输**，以确保数据传输的准确性。
- 交换机工作在这层

**网络层**

- 网络层主要功能是将网络地址转化为对应的物理地址，并决定如何将数据从发送方路由到接收方。
- 路由器属于网络层。
- 主要负责**寻址和路由选择**。主要由 `IP、ICMP` 两个协议组成

**传输层**

- 传输层解决了主机间的数据传输，数据间的传输可以是不同网络，并且传输层解决了**传输质量**的问题。
- 传输层需要关注的协议有TCP/IP协议中的`TCP`协议和`UDP`协议。

**会话层**

- 会话层作用是**负责建立和断开通信连接**，何时建立，断开连接以及保持多久的连接

**表示层**

- 解决**不同系统之间通信语法问题**



## TCP和IP模型

OSI模型注重通信协议必要的功能；TCP/IP更强调在计算机上实现协议应该开发哪种程序

**TCP/IP划分了四层网络模型**

- 第一层：应用层，主要有负责web浏览器的HTTP协议， 文件传输的FTP协议，负责电子邮件的SMTP协议，负责域名系统的DNS等
- 第二层：传输层，主要是有**可靠传输**的TCP协议，特别**高效**的UDP协议。主要负责传输应用层的数据包。
- 第三层：网络层，主要是IP协议。主要负责寻址（找到目标设备的位置）
- 第四层：数据链路层，主要是负责转换数字信号和物理二进制信号。

**四层网络协议的作用**

- 发送端是由上至下，把上层来的数据在头部加上各层协议的数据（部首）再下发给下层。
- 接受端则由下而上，把从下层接受到的数据进行解密和去掉头部的部首后再发送给上层。
- 层层加密和解密后，应用层最终拿到了需要的数据。



**网络层是IP/ICMP协议、在传输层是TCP/UDP协议、在应用层是SMTP、FTP、以及 HTTP 等。他们都属于 TCP/IP 协议。**



## 网络设备



### 交换机

- 交换机接入多台电脑，用 MAC 地址来识别不同的电脑，根据 MAC 地址表进行数据**转发**
- 交换机除了能识别不同的电脑，还需要找到电脑连接的**交换机端口**

### 路由器

交换机的容量和性能有限，MAC 地址太大也无法快速查找到对应的 MAC 地址表项，于是有了三成网络设备 **路由器**，路由器可以把全世界的网络连接起来

局域网内的网络连接可以使用**交换机**，不同区域的局域网互联使用**路由器**



## HTTP

**GET请求和POST请求的区别**

请求的 `url` 长度有限制，这个限制由浏览器和 web 服务器决定和设置的。

GET 请求会被浏览器主动缓存下来，留下历史记录，而 POST 默认不会

**重定向**

301：表示永久重定向，说明请求资源已经不存在了，需要用新的 URL 再次访问

302：表示临时重定向，说明请求的资源还在，但暂时需要另一个 URL 来访问



### HTTP1.1

**长连接**

HTTP 1.1支持长连接

**管道网络传输**

HTTP/1.1 采用了长连接的方式，这使得管道网络传输成为了可能。

即可在同一个 TCP 连接里面，客户端可以发起多个请求，只要第一个请求发出去了，不必等其回来，就可以发第二个请求出去，可以**减少整体的响应时间。**



### HTTP2.0

**HTTP2.0和HTTP1.X相比的新特性**

- 新的二进制格式，`HTTP1.x`的解析是基于文本
- 多路复用，即连接共享，即每一个request都是用作连接共享机制的，一个request对应一个id，这样一个连接上可以有多个request，每个连接的request可以随机的混杂在一起，接收方可以根据request的 id将request再归属到各自不同的服务端请求里面
- header压缩，`HTTP1.x`的header带有大量信息，而且每次都要重复发送，HTTP2.0使用encoder来减少需要传输的header大小，通讯双方各自cache一份header fields表，既避免了重复header的传输，又减小了需要传输的大小
- 服务端推送

**HTTP2.0的多路复用和HTTP1.X中的长连接复用有什么区别**

- HTTP/1.1的Pipeling为若干个请求排队串行化单线程处理，后面的请求等待前面请求的返回才能获得执行机会，一旦有某请求超时等，后续请求只能被阻塞，毫无办法；
- HTTP2.0多个请求可同时在一个连接上并行执行，某个请求任务耗时严重，不会影响到其它连接的正常执行



### HTTPS

**HTTP与HTTPS的区别**

HTTP 是明文传输协议，HTTPS 协议是由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协议，比 HTTP 协议安全

- HTTPS比HTTP更加安全，对搜索引擎更友好，利于SEO，谷歌、百度优先索引HTTPS网页
- HTTPS需要用到SSL证书，而HTTP不用
- HTTPS标准端口443，HTTP标准端口80
- HTTPS基于传输层，HTTP基于应用层
- HTTPS在浏览器显示绿色安全锁，HTTP没有显示

**工作原理**

HTTPS 协议会对传输的数据进行加密，而加密过程是使用了**非对称加密**实现



### 数字证书

通过数字证书的方式保证服务器公钥的身份，决绝冒充的风险

![image-20220818100635050](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220818100635050.png)



## TCP

TCP是一个传输层协议，提供可靠传输，支持全双工，是一个连接导向的协议

TCP是一个双工协议，数据任何时候都可以双向传输，这就意味着客户端和服务端可以平等地发送、接受消息

### **TCP 协议的主要特点**

- TCP是面向连接的传输层协议；所谓面向连接就说双方传输数据之前，必须先建立一条通道，例如三次握手就说建立通道的一个过程，而四次挥手则是销毁通道的一个其中过程。
- 每一条TCP连接只能有两个端点，只能是点对点的；
- TCP 提供可靠的传输服务。传送的数据无差错、不丢失、不重复、按序到达
- TCP 提供全双工通信。允许通信双方的应用进程在任何时候都可以发送数据，因为两端都设有发送缓冲和接受缓存
- 面向字节流。

### TCP 的可靠性原理

1. 传输信道无差错，保证传输数据正确
2. 不管发送方发送以多块的速度发送数据，接收方总是来得及处理收到的数据

首先，采用三次握手来建立 TCP 连接，四次挥手来释放 TCP 连接，从而保证建立的传输信道是可靠的。

### 三次握手

![image-20220818112338259](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220818112338259.png)



**第一次握手**：

客户端将TCP报文标志位`SYN`置为1，随机产生一个序号值`seq=J`，保存在TCP首部的序列号字段里，指明客户端打算连接的服务器的端口，并将该数据包发送给服务器端，发送完毕后，客户端进入`SYN_SENT`状态，等待服务器端确认。

**第二次握手**：

服务器端收到数据包后由标志位`SYN=1`知道客户端请求建立连接，服务器端将TCP报文标志位SYN和ACK都置为1，`ack=J+1`，随机产生一个序号值`seq=K`，并将该数据包发送给客户端以确认连接请求，服务器端进入`SYN_RCVD`状态。

**第三次握手**：

客户端收到确认后，检查ack是否为`J+1`，ACK是否为1，如果正确则将标志位ACK置为1，`ack=K+1`，并将该数据包发送给服务器端，服务器端检查ack是否为`K+1`，ACK是否为1，如果正确则连接建立成功，客户端和服务器端进入`ESTABLISHED`状态，完成三次握手，随后客户端与服务器端之间可以开始传输数据了。

### 四次挥手

![image-20220819095859413](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220819095859413.png)



挥手请求可以是Client端，也可以是Server端发起的，我们假设是Client端发起：

- 第一次挥手： Client端发起挥手请求，向Server端发送标志位是FIN报文段，设置序列号seq，此时，Client端进入`FIN_WAIT_1`状态，这表示Client端没有数据要发送给Server端了。
- 第二次挥手：Server端收到了Client端发送的FIN报文段，向Client端返回一个标志位是ACK的报文段，ack设为seq加1，Client端进入`FIN_WAIT_2`状态，Server端告诉Client端，我确认并同意你的关闭请求。
- 第三次挥手： Server端向Client端发送标志位是FIN的报文段，请求关闭连接，同时Client端进入`LAST_ACK`状态。
- 第四次挥手 ： Client端收到Server端发送的FIN报文段，向Server端发送标志位是ACK的报文段，然后Client端进入`TIME_WAIT`状态，Server端收到Client端的ACK报文段以后，就关闭连接，此时，Client端等待2MSL的时间后依然没有收到回复，则证明Server端已正常关闭，那好，Client端也可以关闭连接了。



## UDP

**UDP协议特点**

- UDP 是无连接的传输层协议
- UDP 使用尽最大努力交付，不保证可靠交付
- UDP 是面向报文的，对应层交下来的报文，不合并，不拆分，保留原报文的边界
- UDP 没有拥塞控制，因此即使网络出现拥塞也不会降低发送速率
- UDP 支持一对一，一对多，多对多的交互通信
- UDP 的首部开销小，只有 8 字节

**UDP和TCP的区别**

- TCP 是可靠传输，UDP 是不可靠传输
- TCP 面向连接，UDP 无连接
- TCP 传输数据有序，UDP 不保证数据的有序性
- TCP 不保存数据边界，UDP 保留数据边界
- TCP 传输速度相对 UDP 较慢
- TCP 有流量控制和阻塞控制，UDP 没有
- TCP 是重量级协议，UDP 是轻量级协议

**基于 TCP 和 UDP 常用协议**

HTTP、HTTPS、FTP、TELNET、SMTP协议基于可靠的 TCP 协议

TFTP、DNS、DHCP、SNTP、RIP 基于不可靠的 UDP 协议



## 网络层

### MAC 地址

MAC 称为物理地址，也叫硬件地址，用来定义网络设备的位置，MAC 地址是网卡出厂时设定的，是固定的。



### IP 地址

IP 地址是以网络号和主机号来标示网络上的主机的，我们把网络号相同的主机称为本地网络，网络号不相同的主机称之为远程网络主机

本地网络中的主机可以直接相互通信，远程网络中的主机要相互通信必须通过本地网关来传递转发数据



### IP 地址格式和表示

IP 地址（IPv4）由32位二进制数组成，分为4段（4个字节），每一段为8位二进制数（1个字节）

**路由器**连接不同网段，负责不同网段之间的数据转发，**交换机**连接的是同一网段的计算机

**IP 地址分类详解**

IP 地址分A、B、C、D、E五类，其中A、B、C这三类是是比较常用的IP地址，D、E类为特殊地址

![image-20220823094959316](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220823094959316.png)

子网掩码

**子网掩码的概念及作用**

通过子网掩码，才能表明一台主机所在的子网与其他子网的关系，使网络正常工作。

子网掩码将网络进一步划分为若干子网，避免主机过多而拥堵或过少而IP浪费

**子网掩码组成**

同IP地址一样，子网掩码是由长度为 32 位二进制数组成的一个地址

子网掩码32位与IP地址地址32位相对应IP地址如果某位是网络地址，则子网掩码为1，否则为0.

**为什么要使用子网掩码**

两台主机要通信，首先要判断是否处于同一网段，即网络地址是否相同

如果相同，那么可以把数据包直接发送到目标主机，否则就需要路由网关将数据包转发送到目的地。

**子网掩码和IP地址的关系**

子网掩码是用来判断任意两台主机的IP地址是否属于同一网络的依据

拿双方主机的IP地址和自己主机的子网掩码做运算如结果为同一网络，就可以直接通信

**如何根据IP地址和子网掩码，计算网络地址**

将IP地址与子网掩码转换成二进制数。

将二进制形式的IP地址与子网掩码做与运算。

将得出的结果转化为十进制，便得到网络地址



### 网关

网关实质上是一个网络通向其他网络的 IP地址

如果网络A中的主机发现数据包的目的主机不在本地网络中，就把数据包转发给它自己的网关，再由网关转发给网络B的网关，网络B的网关再转发给网络B的某个主机。网络B向网络A转发数据包的过程。

**所以说，只有设置好网关的IP地址，TCP / IP协议才能实现不同网络之间的互相通信。**



### DNS

DNS 通过主机名，最终得到改主机名对应的 IP 地址的过程叫做域名解析（或主机名解析）

**工作原理**

将主机域名转换为IP地址，属于应用层协议，使用 UDP 传输

### ARP 协议

ARP 即地址解析协议，用于实现从 IP 地址到 MAC 地址的映射，即询问目标IP对应的MAC地址。



## 数字签名

网路传输过程中需要经过很多中间节点，虽然数据无法被解密，但可能被篡改

数字签名校验数据的完整性

**数字签名有两种功效：**

- 能确定消息确实是由发送方签名并发出来的，因为别人假冒不了发送方的签名。
- 数字签名能确定消息的完整性，证明数据是未被篡改过。



## 加密算法

**对称加密**与**非对称加密**，其中对称加密算法的加密与解密密钥相同，非对称加密算法的加密密钥与解密密钥不同，此外，还有一类不需要密钥的**散列算法。**

### 对称加密

- 数据加密过程：在对称加密算法中，数据发送方 将 **明文** (原始数据) 和 **加密密钥** 一起经过特殊 **加密处理**，生成复杂的 **加密密文** 进行发送。
- 数据解密过程：**数据接收方** 收到密文后，若想读取原数据，则需要使用 **加密使用的密钥** 及相同算法的 **逆算法** 对加密的密文进行解密，才能使其恢复成 **可读明文**。

### 非对称加密

**非对称加密算法**，它需要两个密钥，一个称为 **公开密钥** (`public key`)，即 **公钥**，另一个称为 **私有密钥** (`private key`)，即 **私钥**。

因为 **加密** 和 **解密** 使用的是两个不同的密钥，所以这种算法称为 **非对称加密算法**。

1. 如果使用 **公钥** 对数据 **进行加密**，只有用对应的 **私钥** 才能 **进行解密**。
2. 如果使用 **私钥** 对数据 **进行加密**，只有用对应的 **公钥** 才能 **进行解密**。

**例子**：甲方生成 **一对密钥** 并将其中的一把作为 **公钥** 向其它人公开，得到该公钥的 **乙方** 使用该密钥对机密信息 **进行加密** 后再发送给甲方，甲方再使用自己保存的另一把 **专用密钥** (**私钥**)，对 **加密** 后的信息 **进行解密**。



































