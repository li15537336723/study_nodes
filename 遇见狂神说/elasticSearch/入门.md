# 下载ES及其插件

这里使用7.6.1版本（ES，head，kibana，ik分词器）

![image-20220824094244619](C:\Users\李祥鸿\AppData\Roaming\Typora\typora-user-images\image-20220824094244619.png)

## 启动ES

![image-20220824094334525](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824094334525.png)

![image-20220824094343777](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824094343777.png)

启动之后访问9200

![image-20220824094412901](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824094412901.png)



## 启动head

在head目录下打开黑窗口并执行两条命令

`cnpm install`

`npm run start`



![image-20220824094524466](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824094524466.png)

本地访问 9100

![image-20220824094552373](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824094552373.png) 

## 启动kibana

![image-20220824094651341](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824094651341.png)

本地访问 5601 端口，看到的时候英文版本 kibana，可以对其进行汉化，

![image-20220824094833111](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824094833111.png)

修改 kibana.yml 配置文件后重新启动 kibana 即可

![image-20220824094936671](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824094936671.png)



## ik 分词器

解压 ik 分词器的压缩包后就会有几个 jar 包，将其配置在 ES 中即可

![image-20220824095405091](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824095405091.png)

分词器使用

`ik_smart`：表示最少划分

`ik_max_word`：单词最大程度划分

```json
GET _analyze
{
  "analyzer": "ik_smart",
  "text": "中国共产党"
}

// 效果展示
{
  "tokens" : [
    {
      "token" : "中国共产党",
      "start_offset" : 0,
      "end_offset" : 5,
      "type" : "CN_WORD",
      "position" : 0
    }
  ]
}
```

```json
GET _analyze
{
  "analyzer": "ik_max_word",
  "text": "中国共产党"
}

// 效果展示
{
  "tokens" : [
    {
      "token" : "中国共产党",
      "start_offset" : 0,
      "end_offset" : 5,
      "type" : "CN_WORD",
      "position" : 0
    },
    {
      "token" : "中国",
      "start_offset" : 0,
      "end_offset" : 2,
      "type" : "CN_WORD",
      "position" : 1
    },
    {
      "token" : "国共",
      "start_offset" : 1,
      "end_offset" : 3,
      "type" : "CN_WORD",
      "position" : 2
    },
    {
      "token" : "共产党",
      "start_offset" : 2,
      "end_offset" : 5,
      "type" : "CN_WORD",
      "position" : 3
    },
    {
      "token" : "共产",
      "start_offset" : 2,
      "end_offset" : 4,
      "type" : "CN_WORD",
      "position" : 4
    },
    {
      "token" : "党",
      "start_offset" : 4,
      "end_offset" : 5,
      "type" : "CN_CHAR",
      "position" : 5
    }
  ]
}
```



## Rest 风格说明

![image-20220824153920441](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824153920441.png)



> 基础测试

1、创建一个索引！

```
put	/索引名/~类型名~/文档id
{请求体}
```

![image-20220824154220170](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824154220170.png)

2、完成了自动增加了索引！数据也成功的添加了

![image-20220824154329552](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824154329552.png)

3、数据类型



4、执行字段类型

![image-20220824155025409](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824155025409.png)

获得这个规则！可以通过 GET 请求获取具体的信息

![image-20220824155148630](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824155148630.png)

5、查看默认的信息

![image-20220824155641511](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824155641511.png)

> 修改 提交还是使用 PUT 即可，然后覆盖！

![image-20220824160135453](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824160135453.png)

> 使用 post 方式进行修改

![image-20220824160342474](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824160342474.png)

> 删除索引

![image-20220824160433917](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824160433917.png)



## 关于文档的基本操作（重点）

> 基本操作

1、添加数据

```java
PUT /lixianghong/user/1
{
  "name": "lixianghong",
  "age": 20,
  "desc": "一顿操作猛如虎，一看工资2500",
  "tags": ["技术大佬", "NBA选手"]
}
```



![image-20220824160948700](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824160948700.png)

2、获取数据

![image-20220824161517094](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824161517094.png)



3、更新数据 put 命令

![image-20220824161641520](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824161641520.png)

4、Post _update，推荐使用这个更新方式！

![image-20220824162021011](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824162021011.png)



简单的查询！可以根据默认的映射规则，产生基本的查询！

![image-20220824173500356](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824173500356.png)



> 复杂操作搜索 select（排序，分页，高亮，模糊查询，精准查询）

![image-20220824173937856](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824173937856.png)

![image-20220824174410864](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824174410864.png)



多条件查询，控制输出量

![image-20220824174528937](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220824174528937.png)

之后使用 java 操作 es，所有的方法和对象就是这里面的 key！

> 排序

![image-20220825094232004](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220825094232004.png)

> 分页操作

![image-20220825094346181](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220825094346181.png)

数据下标是从0开始的，与之前学习的数据结构基本一样



> 布尔值查询

must（and），所有的条件都要符合 where id = 1 and name = xxx

![image-20220825094835788](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220825094835788.png)

should（or），所有的条件都要符合 `where id = 1 or name = xxx`

![image-20220825095056876](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220825095056876.png)

must_not（not）

![image-20220825095235202](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220825095235202.png)

过滤 filter

![image-20220825095521823](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220825095521823.png)

- gt —— 大于
- gte —— 大于等于
- lt —— 小于
- lte —— 小于等于

![image-20220825095952338](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220825095952338.png)



> 精确查询

term 查询是直接通过倒排索引指定的词条进行精确的查找的！

关于分词：

- term，直接查询精确的

- match，会使用分词器解析！（先分析文档，然后通过分析的文档进行查询）

**两个类型 text  keyword**

![image-20220825101057751](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220825101057751.png)

![image-20220825101122971](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220825101122971.png)

![image-20220825101449705](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220825101449705.png)



> 多个值配置精确查询

![image-20220825102204570](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220825102204570.png)



> 高亮查询

![image-20220825102443929](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220825102443929.png)

![image-20220825102708054](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220825102708054.png)

- 匹配
- 按照条件匹配
- 精确匹配
- 区间范围匹配
- 匹配字段过滤
- 多条件查询
- 高亮查询



## 具体的API测试

1、创建索引

2、判断索引是否存在

3、删除索引

4、创建文档

5、crud 文档！







## springboot 与 es 操作实践

### 一、config文件

主要连接 es 客户端

```java
@Configuration
public class ElasticSearchClientConfig {

  @Bean
  public RestHighLevelClient restHighLevelClient() {
    return new RestHighLevelClient(
            RestClient.builder(
                    new HttpHost("127.0.0.1", 9200, "http")
            )
    );
  }
}
```



### 二、测试常用的操作

代码在 test 的文件夹下的 test 类中



### 三、在京东上爬虫一些信息

主要进行前后的测试，以及查询关键字高亮等































