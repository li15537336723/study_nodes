# 一、理论



## 1、Yarn 基础架构

![image-20220613092237488](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220613092237488.png)



**1）ResourceManager(RM) 主要作用如下**

（1）处理客户端请求

（2）监控 NodeManager

（3）启动或监控 ApplicationMaster

（4）资源的分配与调度

**2）NodeManager（NM）主要作用如下**

（1）管理单个节点上的资源

（2）处理来自 ResourceManager 的命令

（3）处理来自 ApplicationMaster 的命令



**3）ApplicationMaster（AM）作用如下**

（1）作为应用程序申请并分配给内部的任务

（2）任务的监控与容错



## 2、Yarn 工作机制





## 3、Mapreduce/HDFS/Yarn







## 4、调度器和算法

目前，Hadoop 作业调度器主要有三种：FIFO、容量（Capacity Scheduler）和公平（Fair Scheduler）。Apache Hadoo3.3.3 默认调度器是 Capacity Scheduler。



### 4.1 FIFO

FIFO 调度器：但队列，根据提交作业的先后顺序，先来先服务

<img src="https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220613093327264.png" alt="image-20220613093327264" style="zoom:50%;" />



### 4.2 容器调度器

<img src="https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220613094126889.png" alt="image-20220613094126889" style="zoom: 33%;" />

**1、多队列：**每个队列可配置一定的资源量，每个队列采用 FIFIO 调度策略

**2、容量保证：**管理员可为每个队列设置资源最低保证和资源使用上限

**3、灵活性：**如果一个队列中的资源有剩余，可以暂时共享给那些需要资源的队列，而一旦该队列有新的应用程序提交，则其他队列借调的资源会归还给该队列。

**4、多租户：**

​	支持多用户共享集群和多应用程序同时运行

​	为了防止同一个用户的作业独占队列中的资源，该调度器会对**==同一用户提交的作业所占资源进行限定==**



<img src="https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220613095229243.png" alt="image-20220613095229243" style="zoom:50%;" />

**1、队列资源分配**

从 root 开始，使用深入优先算法，**==优先选择资源占用率最低==**的队列分配资源

**2、作业资源分配**

默认按照提交作业的**优先级**和**提交时间**顺序分配资源

**3、容器资源分配**

按照容器的**优先级**分配资源；

如果优先级相同，按照数据本地行原则

（1）任务和数据在同一节点

（2）任务和数据在同一机架

（3）任务和数据不在同一节点也不在同一机架





### 4.3 公平调度器

![image-20220613100751204](https://lixianghong.oss-cn-beijing.aliyuncs.com/typore/image-20220613100751204.png)

**1、与容量调度器相同点**

（1）多队列：支持多队列作业

（2）容量保证：管理员可为每个队列设置资源最低保证和资源使用上限

（3）灵活性：如果一个队列中资源有剩余，可以暂时共享给那些需要资源的队列，而一旦该队列有新的应用程序提交，则其他队列借调的资源会归还给该队列。

（4）多租户：支持多用户共享集群和多应用程序同时运行；为了防止同一个用户的作业独占队列中的资源，该调度器会与同一个用户提交的作业所占资源量进行限定。

**2、与容量调度器不同点**

（1）核心调度策略不同

容量调度器：优先选择**==资源利用率低==**的队列

公平调度器：优先选择对资源的**==缺额==**比例大的

（2）每个队列可以单独设置资源分配方式

容量调度器：FIFO，**DRF**

公平调度器：FIFO，**FAIR，DRF**



**1）FIFO 策略**

公平调度器每个队列资源分配策略如果选择 FIFO 的话，此时公平调度器相当于上面的容器调度器

**2）Fair 策略**

Fair 策略是一种基于最大最小公平算法实现的资源多路复用方式，默认情况下，每个队列内部采用该方式分配资源。这意味着，如果一个队列中有两个应用程序同时运行，则每个应用程序可得到 1/2 的资源；如果三个应用程序同时运行，则每个应用程序可得到 1/3 的资源。

具体资源分配流程和容量调度器一致

（1）选择队列

（2）选择作业

（3）选择容器

以上三步，每一步都是按照公平策略分配资源









## 5、Yarn 在生产环境下需要配置哪些参数



## 6、命令行操作 Yarn



# 二、怎么操作

## 1、生产环境下参数怎么配置



## 2、容器调度在生产环境配置



## 3、公平调度器在生产环境配置



## 4、Yarn 的 tool 接口





























