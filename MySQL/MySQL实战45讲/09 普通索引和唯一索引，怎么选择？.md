# 09 | 普通索引和唯一所以怎么选择？

**更新操作**

当需要更新一个数据页时，InnoDB 会将这些更新操作缓存在 change buffer 中，这样干就不需要从磁盘中读取这个数据页了。在下次查询需要访问这个数据页的时候，将数据页读入内存，然后执行 change buffer 中与这个页有关的操作

将 change buffer 中的操作应用到原数据页，得到最新结果的过程为 merge

**什么条件下可以使用change buffer？**

对于唯一索引来说，所有的更新操作都要先预判这个操作释放违反唯一性约束，如：要插入一条记录时，首先判断表中是否存在该条记录，而且必须要将数据页读入内存才能判断

如果插入（4，400）这条记录

第一种情况，这个记录要更新的目标页**在内存**中，这时，InnoDB的处理流程如下

- 对于唯一索引来说，找到 3 和 5 之间的位置，判断到没有冲突，插入这个值，语句执行结束
- 对于普通索引来说，找到 3 和 5 之间的位置，插入这个值，语句执行结束

第二种情况，这个记录要更新的目标 **不在内存** 中，这时，InnoDB的处理如下：

- 对于唯一索引来说，需要将数据页读入内存，判断到没有冲突，插入这个值，语句执行结束
- 对于普通索引来说，则是将更新记录在 change buffer，语句执行就结束了





